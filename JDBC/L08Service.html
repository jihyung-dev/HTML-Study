<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Service 계층</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/src/css/study.css">

</head>
<body>
<header>
    <h1>Service 계층 </h1>
</header>

<section>
    <h2>1. Service의 개념</h2>
    <ul>
        <li>비즈니스 로직(업무 규칙)을 담당하는 계층</li>
        <li>Controller가 받은 요청을 처리하기 위한 핵심 로직 수행</li>
        <li>DAO가 “데이터 접근”을 한다면, Service는 “데이터를 어떻게 사용할지”를 결정</li>
    </ul>
</section>

<section>
    <h2>2. Service의 역할</h2>
    <ul>
        <li>업무 규칙 수행: 중복 체크, 계산, 정책 적용 등</li>
        <li>DAO 조합 및 호출 순서 제어: 여러 데이터 작업을 하나의 절차로 묶음</li>
        <li>트랜잭션 경계 설정: commit/rollback 제어로 원자성 보장</li>
        <li>입력 검증 및 예외 처리: 잘못된 입력 차단, 의미 있는 예외 변환</li>
        <li>Controller와 DAO의 중간 계층: 처리 과정은 Service, 표현은 Controller</li>
    </ul>
</section>

<section>
    <h2>3. Service가 필요한 이유</h2>
    <ul>
        <li>관심사 분리: 화면 처리·데이터 접근·규칙 수행을 분리</li>
        <li>재사용성 향상: 동일 규칙을 웹/콘솔/배치 등 다양한 진입점에서 재사용</li>
        <li>유지보수 용이: 규칙 변경 시 Controller/DAO 수정 최소화</li>
        <li>트랜잭션 관리: 여러 작업을 하나의 트랜잭션 단위로 묶어 일관성 유지</li>
        <li>테스트 용이: UI·DB 없이도 규칙 단위 테스트 가능</li>
    </ul>
</section>

<section>
    <h2>4. 계층 구조에서의 위치</h2>
    <pre><code>Controller  →  Service  →  DAO  →  Database</code></pre>
    <ul>
        <li>Controller: 요청 수신, 파라미터 처리, 응답 반환</li>
        <li>Service: 업무 로직, 트랜잭션, 예외 처리</li>
        <li>DAO: SQL 실행, 데이터 CRUD</li>
    </ul>
</section>

<section>
    <h2>5. 설계 원칙</h2>
    <p>
        Service 계층 설계는 단순히 코드를 나누는 것이 아니라,
        <strong>객체지향(OOP)의 설계 원칙</strong>을 적용해
        <em>유지보수성, 확장성, 재사용성</em>을 높이기 위한 구조 설계이다.
        즉, 타입(클래스, 인터페이스)을 어떻게 나눌지에 대한 전략이며,
        코드의 변경에 강하고 재사용 가능한 형태로 만드는 것이 핵심이다.
    </p>

    <ul>
        <li>
            <strong>단일 책임 원칙(SRP: Single Responsibility Principle)</strong><br>
            하나의 클래스는 하나의 책임만 가져야 한다는 원칙이다.
            Service는 “업무 로직 수행”이라는 하나의 책임만 가져야 하며,
            화면 처리나 DB 쿼리 실행 같은 역할은 Controller나 DAO에 맡긴다.
            이렇게 하면 코드 수정 범위가 좁아지고, 테스트가 쉬워진다.
        </li>

        <li>
            <strong>의존 역전 원칙(DIP: Dependency Inversion Principle)</strong><br>
            상위 모듈(서비스 로직)은 하위 세부 구현(DAO 클래스)에 의존하지 않고,
            <em>인터페이스(추상화)</em>에 의존해야 한다는 원칙이다.
            예를 들어 Service가 EmpDaoImpl에 직접 의존하지 않고 EmpDao 인터페이스에 의존하면,
            구현체 교체나 테스트 더블(mock) 사용이 자유로워진다.
        </li>

        <li>
            <strong>개방-폐쇄 원칙(OCP: Open-Closed Principle)</strong><br>
            소프트웨어 구성 요소는 “확장에는 열려 있고, 변경에는 닫혀 있어야 한다.”
            새로운 규칙이나 기능이 추가될 때 기존 클래스를 직접 수정하지 않고,
            새로운 클래스를 확장하거나 인터페이스를 추가 구현하는 방식으로 대응할 수 있어야 한다.
            예를 들어 급여 계산 방식이 바뀌어도 기존 EmpService 구조를 수정하지 않고
            새 규칙 클래스를 주입해 확장할 수 있다.
        </li>

        <li>
            <strong>경계 명확화 (Clear Boundaries)</strong><br>
            계층 간 책임이 혼합되지 않도록 Controller, Service, DAO 간의 데이터 교환은
            DTO나 Command 객체를 통해 이루어진다.
            이렇게 하면 각 계층이 서로의 내부 구조에 의존하지 않게 되어,
            계층 간 결합도를 낮추고 코드 변경에 유연하게 대응할 수 있다.
        </li>
    </ul>
</section>
<section>
    <h2>6. Service의 주요 기능 요약</h2>
    <ul>
        <li>입력 검증</li>
        <li>비즈니스 규칙 수행</li>
        <li>여러 DAO 호출 조합</li>
        <li>트랜잭션 시작/종료(commit, rollback)</li>
        <li>예외 처리 및 의미 있는 예외로 변환</li>
        <li>결과 데이터 조립 및 반환</li>
    </ul>
</section>

<section>
    <h2>7. 트랜잭션과의 관계</h2>
    <ul>
        <li>트랜잭션 경계는 보통 Service 메서드 단위로 설정</li>
        <li>여러 DAO 호출을 하나의 업무 단위로 묶어 일관성 유지</li>
        <li>실패 시 rollback, 성공 시 commit</li>
    </ul>
</section>

<section>
    <h2>8. 예외 처리 전략</h2>
    <ul>
        <li>입력 오류·DB 오류 등은 Service에서 선별·변환</li>
        <li>기술 예외(SQLException 등)를 도메인 친화적 예외로 변환</li>
        <li>Controller는 메시지·상태코드 중심으로 응답 처리</li>
    </ul>
</section>

<section>
    <h2>9. 장점 요약</h2>
    <ul>
        <li>구조 명확: Controller·Service·DAO 역할 분리</li>
        <li>변경에 강함: 파급효과 최소화</li>
        <li>테스트 쉬움: 규칙 단위 테스트 가능</li>
        <li>트랜잭션 관리 가능: 원자성·일관성 보장</li>
        <li>재사용성 향상: 동일 로직을 여러 진입점에서 활용</li>
    </ul>
</section>

<section>
    <h2>10.사원 서비스 예시</h2>
    <pre><code>// 1) Service 인터페이스
public interface EmpService {
    Emp register(EmpDto cmd) throws Exception;
}

// 2) Service 구현
public class EmpServiceImpl implements EmpService {

    private final EmpDao empDao;
    private final DeptDao deptDao;
    private final Connection conn;

    public EmpServiceImpl(Connection conn) {
        // Service가 스스로 DAO와 Connection을 준비
        // Controller는 단순히 Service만 호출
        this.empDao = new EmpDao(conn);
        this.deptDao = new DeptDao(conn);
    }

    @Override
    public Emp register(EmpDto emp) throws Exception {
        // 1) 기본 유효성 검증
        if (emp == null) throw new IllegalArgumentException("입력이 없습니다.");
        if (emp.ename() == null || emp.ename().isBlank()) throw new IllegalArgumentException("ename은 필수입니다.");
        if (emp.sal() < 0) throw new IllegalArgumentException("sal은 음수가 될 수 없습니다.");

        try {
            conn.setAutoCommit(false);

            // 2) empno 중복 검사
            if (empDao.existsByEmpNo(emp.empNo())) {
                throw new IllegalStateException("이미 존재하는 사번입니다: " + cmd.empNo());
            }

            // 3) 부서 존재 여부 확인
            if (!deptDao.existsByDeptNo(emp.deptNo())) {
                throw new IllegalStateException("존재하지 않는 부서입니다: " + cmd.deptNo());
            }

            // 4) 등록
            empDao.insertOne(emp);
            // 5) 등록한 유저 조회
            EmpDto saveEmp=empDao.findById(emp.empNo());
            // 6) 커밋
            conn.commit();
            return saveEmp; //등록한 유저 반환

        } catch (Exception e) {
            // 모든 오류 발생 시 롤백
            conn.rollback();
            throw e; // 예외 위임 → Controller에서 처리
        } finally {
            // 트랜잭션 종료 후 자동 커밋 원복
            conn.setAutoCommit(true);
        }
    }
}</code></pre>
</section>
<h2>자주 사용되는 서비스 이름</h2>
<section>
    <h3>1. CRUD 기본 메서드</h3>
    <ul>
        <li><strong>등록(Create):</strong> register, add, create, insert
            새로운 데이터를 추가할 때 사용</li>
        <li><strong>조회(Read):</strong> find, get, read, search, list
            데이터를 단건 또는 다건 조회할 때 사용</li>
        <li><strong>수정(Update):</strong> update, modify, change, edit
            기존 데이터 일부를 변경할 때 사용</li>
        <li><strong>삭제(Delete):</strong> delete, remove, withdraw
            데이터를 삭제하거나 비활성화할 때 사용</li>
    </ul>

    <pre><code>
Emp register(EmpDto dto);
Emp findById(long empNo);
List&lt;Emp&gt; findAll();
boolean updateSalary(long empNo, long newSalary);
boolean delete(long empNo);
  </code></pre>
</section>

<section>
    <h3>2. 인증/회원 관련 서비스 메서드</h3>
    <ul>
        <li><strong>회원가입:</strong> register, signUp, createAccount</li>
        <li><strong>로그인:</strong> login, signIn, authenticate</li>
        <li><strong>로그아웃:</strong> logout, signOut</li>
        <li><strong>회원조회:</strong> findById, getMember, readProfile</li>
        <li><strong>정보수정:</strong> updateInfo, modifyProfile</li>
        <li><strong>탈퇴:</strong> withdraw, deleteAccount</li>
    </ul>
</section>

<section>
    <h3>3. 게시판/게시글 관련 메서드</h3>
    <ul>
        <li><strong>게시글 등록:</strong> writePost, registerPost, createPost</li>
        <li><strong>게시글 목록 조회:</strong> listPosts, findAll, getPosts</li>
        <li><strong>게시글 상세 조회:</strong> readPost, findPostById</li>
        <li><strong>게시글 수정:</strong> updatePost, editPost</li>
        <li><strong>게시글 삭제:</strong> deletePost, removePost</li>
        <li><strong>댓글 등록:</strong> addComment, registerComment</li>
        <li><strong>댓글 삭제:</strong> deleteComment</li>
        <li><strong>좋아요 추가:</strong> likePost, addLike</li>
        <li><strong>좋아요 취소:</strong> cancelLike, removeLike</li>
        <li><strong>싫어요 추가:</strong> dislikePost, addDislike</li>
        <li><strong>싫어요 취소:</strong> cancelDislike, removeDislike</li>
        <li><strong>조회수 증가:</strong> increaseViewCount, addView</li>
    </ul>
</section>

<section>
    <h3>4. 업무/트랜잭션성 서비스 메서드</h3>
    <ul>
        <li><strong>승인/처리:</strong> approve, process, complete</li>
        <li><strong>취소:</strong> cancel, rollback, revert</li>
        <li><strong>요청:</strong> request, apply, submit</li>
        <li><strong>결과조회:</strong> getResult, findStatus, readDetail</li>
        <li><strong>예약:</strong> reserve, book</li>
        <li><strong>실행:</strong> execute, runTask, perform</li>
    </ul>
</section>
</body>
</html>