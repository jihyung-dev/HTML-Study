<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>비동기함수를 동기화하는 Promise</title>
</head>
<body>
<h1>비동기함수를 동기화하는 Promise</h1> <!--비동기함수는 통신에 사용됨-->
<script>

    let a = 10;                           //micro task

    //통신 == setTimeout
    setTimeout(() => {
        a += 10;
        console.log("1차 setTimeout의 a:", a);  //20
        setTimeout(() => {
            a += 10;
            console.log("2차 setTimeout의 a:", a); //30
            setTimeout(() => {
                a += 10;
                console.log("3차 setTimeout의 a:", a);
            })

        })

    }, 0)  //1000초 뒤에 실행
    // 비동기 Web API( 비동기 함수를 모아서 실행을 담당함)

    //비동기함수에서 실행을 동기화하는 일반적인 방법
    ///=> 콜백지옥을 유발함
    console.log("바깥의 a:", a); //먼저 log가 나옴 //null


    let n = 10;
    new Promise((resolve) => { // 비동기함수를 동기화
        setTimeout(() => {
            n += 10;
            resolve();  //Promise의 다음 함수 : then(체이닝)이라는 콜백함수를 실행함
        }, 0); //즉시 실행

    }).then(() => { //위의 resolve시점에서 동기화해서 then에서 실행
        return new Promise((resolve) => { //then 시점을 동기화하고 싶으면 return 으로 promise를 해야함
            setTimeout(() => {
                n += 10;
                resolve();
            }, 0)
        }).then(() => { //then 콜백함수가 resolve 이다.
            n += 10;
            console.log("then의 then n:", n)
        })
    })
    console.log("n:", n)


    //#2  //promise화의 목적 : 코드를 줄이기 위해 (리펙터링)
    //promise화 //setTimeoutPromise() === new Promise ()
    function setTimeoutPromise(func,ms=0){ //기본값이 있는 친구는 맨 뒤에 둬야함
        return new Promise((resolve)=>{
            setTimeout(() => {
                func();
                resolve();
            },ms)
        })
    }

    let b = 10;
    setTimeoutPromise(() => { //=newPromise
        b += 10;
    }, 1000).then(() => {
        console.log("then:", b)
        return setTimeoutPromise(() => {
            b += 10;
        }, 1000);
    }).then(() => {
        console.log(b)
        return setTimeoutPromise(() => {
            b += 10;
        }, 1000).then(() => {
            console.log(b)
        })
    })

    //async 함수 promise로 작성된 함수를 await로 동기화

    let c=10;
    async function cIncrement(){             //await는 async에서 사용가능
        await setTimeoutPromise(()=>{c+=10},1000); //await는 then을 실행
        console.log("c:",c)
        await setTimeoutPromise(()=>{c+=10},1000);
        console.log("c:",c)
        await setTimeoutPromise(()=>{c+=10},1000);
        console.log("c:",c)
        await setTimeoutPromise(()=>{c+=10},1000);
        console.log("c:",c)
        await setTimeoutPromise(()=>{c+=10},1000);
        console.log("c:",c)
    }
    cIncrement();


</script>


</body>
</html>