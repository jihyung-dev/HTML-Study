<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ajax XMLHttpRequest</title>
</head>
<body>
    <h1>ajax XMLHttpRequest</h1>

    <hr>
    <h2>유저 정보 AJAX불러오기
        <button id="loadUsersBtn">로드</button>
    </h2>
    <table id="users" border="1">
        <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>score</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>

        const usersBody = document.querySelector('#users>tbody');
        const loadusersBtn = document.querySelector('#loadUsersBtn');

        //비동기 함수 ( 버튼을 클릭했을때, 실행할 내용을 정의하는 함수)
        const loadUsers=()=>{
            //http://localhost:63342/html_Study/javascript/L33XmlHttpRequest.html
            //http://localhost:63342/html_Study/javascript/L33Users.json
            let url="./L33Users.json"
            //통신
            //통신방식
            // 1) get : url로 resource를 주세요
            // 2) post : 양식을 제출, 전송할 데이터를 포함시킴
            const request = new XMLHttpRequest(); //비동기식 통신 객체생성
            request.open("GET", url );                  //요청 초기화.
            request.send();                             //서버에 요청을 보냄

            request.onload=function(){
                //데이터 통신이 완료되는 시점에 동작하는 콜백함수 재 정의 //내가 임의로 정하는 시점 X
                let status=request.status;
                if(status == 200){
                    // console.log(request.responseText);
                    const users=JSON.parse(request.responseText);
                    console.log(users)
                    let html="";
                    for(let user of users){
                        html+=`<tr>
                                    <td>${user.id}</td>
                                    <td>${user.name}</td>
                                    <td>${user.score}</td>
                                </tr>`
                        console.log(html)
                        usersBody.innerHTML=html;
                    }
                }
            }
        }
    loadusersBtn.addEventListener("click", loadUsers);



        //비동기함수가 통신이 완료되는 시점을 제공해야함
        // let json=request.responseText;  //요청한 내역을 서버가 전달한 것 (resource)
        // console.log(json)
        // setTimeout(()=>{
        //     console.log(request.responseText)
        // },1000)

        //onload, onreadystatechange //통신이 완료되는 시점

        //404 (Not Found)는 서버가 보내주는 오류


    </script>

</body>
</html>